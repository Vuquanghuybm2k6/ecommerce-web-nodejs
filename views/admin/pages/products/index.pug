extends ../../layouts/default.pug
include ../../mixins/filter-status.pug
include ../../mixins/search.pug
include ../../mixins/pagination.pug
include ../../mixins/form-change-multi.pug
include ../../mixins/alert.pug
include ../../mixins/sort.pug
block main 
  if(role.permissions.includes("products_view"))
    +alert-success(5000)
    h1 Danh sách sản phẩm
    .card 
      .card-header Bộ lọc và tìm kiếm
      .card-body 
        .row
          .col-6
            +filter-status(filterStatus)
          .col-6 
            +search(keyword)
    .card 
      .card-header Sắp xếp 
      .card-body 
        .row 
          .col-4 
            +sort
    .card 
      .card-header Danh sách sản phẩm
      .card-body
        .row 
          .col-8
            +form-change-multi(`${prefixAdmin}/products/change-multi?_method=PATCH`)
          .col-4 
            a(href = `${prefixAdmin}/products/create` class = "btn btn-outline-success") + Thêm mới
        table(class = "table table-hover table-sm" checkbox-multi)
          thead
            tr 
              th 
                input(type = "checkbox" name = "checkall") 
              th STT
              th Hình ảnh 
              th Tiêu đề
              th Giá 
              th Vị trí
              th Trạng thái
              th Hành động
          tbody 
            each item, index in products
              tr 
                td 
                  input(type = "checkbox" name = "id" value = item.id)
                td #{pagination.limitItem*(pagination.currentPage - 1)+(index+1)} 
                td 
                  img(src = item.thumbnail, alt = item.title width = "100px" height = "auto")
                td #{item.title}
                td #{item.price}$
                td 
                  input(value = item.position min ="1" name = "position" type ="number" style = "width: 60px")
                td
                  if(role.permissions.includes("products_edit")) 
                    if (item.status =="active")
                      a(
                        href = `javascript: ;` 
                        class = "badge badge-success" 
                        data-status = item.status 
                        data-id = item.id 
                        button-change-status
                        ) Hoạt động
                    else 
                      a(
                        href = `javascript: ;` 
                        class = "badge badge-danger" 
                        data-status = item.status 
                        data-id = item.id 
                        button-change-status
                        ) Dừng hoạt động
                  else
                    if (item.status =="active")
                      a(
                        class = "badge badge-success" 
                        ) Hoạt động
                    else 
                      a(
                        class = "badge badge-danger" 
                        ) Dừng hoạt động
                td 
                  a(class = "btn btn-secondary btn-sm mr-1" href =`${prefixAdmin}/products/detail/${item.id}`) Chi tiết
                  if(role.permissions.includes("products_edit"))
                    a(class = "btn btn-warning btn-sm mr-1" href =`${prefixAdmin}/products/edit/${item.id}`) Sửa
                  if(role.permissions.includes("products_delete"))
                    button(class = "btn btn-danger btn-sm" button-delete data-id = item.id) Xóa
    +pagination(pagination)
    form(
      action = ``
      method = "POST"
      data-path = `${prefixAdmin}/products/change-status`
      id = `form-change-status`
    )
    form(
      action =``
      method = "POST"
      data-path = `${prefixAdmin}/products/delete`
      id = "form-delete-item"
    )
    script(src = "/admin/js/product.js")        
    